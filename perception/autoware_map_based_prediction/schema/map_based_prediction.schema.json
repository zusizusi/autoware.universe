{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Parameters for Map Based Prediction",
  "type": "object",
  "definitions": {
    "map_based_prediction": {
      "type": "object",
      "properties": {
        "prediction_time_horizon": {
          "type": "object",
          "properties": {
            "vehicle": {
              "type": "number",
              "default": 15.0,
              "description": "predict time duration for predicted path of vehicle"
            },
            "pedestrian": {
              "type": "number",
              "default": 10.0,
              "description": "predict time duration for predicted path of pedestrian"
            },
            "unknown": {
              "type": "number",
              "default": 10.0,
              "description": "predict time duration for predicted path of unknown"
            }
          },
          "required": ["vehicle", "pedestrian", "unknown"]
        },
        "lateral_control_time_horizon": {
          "type": "number",
          "default": 5.0,
          "description": "time duration for predicted path will reach the reference path (mostly center of the lane)"
        },
        "prediction_sampling_delta_time": {
          "type": "number",
          "default": 0.5,
          "description": "sampling time for points in predicted path"
        },
        "min_velocity_for_map_based_prediction": {
          "type": "number",
          "default": 1.39,
          "description": "apply map-based prediction to the objects with higher velocity than this value"
        },
        "min_crosswalk_user_velocity": {
          "type": "number",
          "default": 1.39,
          "description": "minimum velocity use in path prediction for crosswalk users"
        },
        "max_crosswalk_user_delta_yaw_threshold_for_lanelet": {
          "type": "number",
          "default": 0.785,
          "description": "maximum yaw difference between crosswalk user and lanelet to use in path prediction for crosswalk users"
        },
        "max_crosswalk_user_on_road_distance": {
          "type": "number",
          "default": 2.0,
          "description": "crosswalk users on road or shoulder lanelets are only predicted to cross the crosswalk if they are within this distance"
        },
        "dist_threshold_for_searching_lanelet": {
          "type": "number",
          "default": 3.0,
          "description": "The threshold of the angle used when searching for the lane to which the object belongs "
        },
        "delta_yaw_threshold_for_searching_lanelet": {
          "type": "number",
          "default": 0.785,
          "description": "The threshold of the distance used when searching for the lane to which the object belongs"
        },
        "sigma_lateral_offset": {
          "type": "number",
          "default": 0.5,
          "description": "Standard deviation for lateral position of objects "
        },
        "sigma_yaw_angle_deg": {
          "type": "number",
          "default": 5.0,
          "description": "Standard deviation yaw angle of objects "
        },
        "object_buffer_time_length": {
          "type": "number",
          "default": 2.0,
          "description": "Time span of object history to store the information"
        },
        "history_time_length": {
          "type": "number",
          "default": 1.0,
          "description": "Time span of object information used for prediction"
        },
        "check_lateral_acceleration_constraints": {
          "type": "boolean",
          "default": false,
          "description": "whether to check if the predicted path complies with lateral acceleration constraints"
        },
        "max_lateral_accel": {
          "type": "number",
          "default": 2.0,
          "description": "max acceptable lateral acceleration for predicted vehicle paths"
        },
        "min_acceleration_before_curve": {
          "type": "number",
          "default": -2.0,
          "description": "min acceleration a vehicle might take to decelerate before a curve"
        },
        "use_vehicle_acceleration": {
          "type": "boolean",
          "default": false,
          "description": "whether to consider current vehicle acceleration when predicting paths or not"
        },
        "speed_limit_multiplier": {
          "type": "number",
          "default": 1.5,
          "description": "When using vehicle acceleration. Set vehicle's maximum predicted speed as the legal speed limit in that lanelet times this value"
        },
        "acceleration_exponential_half_life": {
          "type": "number",
          "default": 2.5,
          "description": "When using vehicle acceleration. The decaying acceleration model considers that the current vehicle acceleration will be halved after this many seconds"
        },
        "crosswalk_with_signal": {
          "type": "object",
          "properties": {
            "use_crosswalk_signal": {
              "type": "boolean",
              "default": true
            },
            "threshold_velocity_assumed_as_stopping": {
              "type": "number",
              "default": 0.25,
              "description": "velocity threshold for the module to judge whether the objects is stopped"
            },
            "distance_set_for_no_intention_to_walk": {
              "type": "array",
              "items": { "type": "number" },
              "default": [1.0, 5.0],
              "description": "ascending order, keys of map"
            },
            "timeout_set_for_no_intention_to_walk": {
              "type": "array",
              "items": { "type": "number" },
              "default": [1.0, 0.0],
              "description": "values of map"
            }
          },
          "required": [
            "use_crosswalk_signal",
            "threshold_velocity_assumed_as_stopping",
            "distance_set_for_no_intention_to_walk",
            "timeout_set_for_no_intention_to_walk"
          ]
        },
        "prediction_time_horizon_rate_for_validate_shoulder_lane_length": {
          "type": "number",
          "default": 0.8,
          "description": "prediction path will disabled when the estimated path length exceeds lanelet length. This parameter control the estimated path length"
        },
        "use_crosswalk_user_history": {
          "type": "object",
          "properties": {
            "match_lost_and_appeared_users": {
              "type": "boolean",
              "default": false
            },
            "remember_lost_users": {
              "type": "boolean",
              "default": false
            }
          },
          "required": ["match_lost_and_appeared_users", "remember_lost_users"]
        },
        "crossing_intention_duration": {
          "type": "number",
          "default": 0.3,
          "description": "Minimum duration that crossing intention must continuously persist to be judged as true"
        },
        "no_crossing_intention_duration": {
          "type": "number",
          "default": 1.0,
          "description": "Minimum duration that lack of crossing intention must continuously persist to be judged as false"
        },
        "lane_change_detection": {
          "type": "object",
          "properties": {
            "method": {
              "type": "string",
              "enum": ["lat_diff_distance", "time_to_change_lane"],
              "default": "lat_diff_distance"
            },
            "time_to_change_lane": {
              "type": "object",
              "properties": {
                "dist_threshold_for_lane_change_detection": {
                  "type": "number",
                  "default": 1.0
                },
                "time_threshold_for_lane_change_detection": {
                  "type": "number",
                  "default": 5.0
                },
                "cutoff_freq_of_velocity_for_lane_change_detection": {
                  "type": "number",
                  "default": 0.1
                }
              },
              "required": [
                "dist_threshold_for_lane_change_detection",
                "time_threshold_for_lane_change_detection",
                "cutoff_freq_of_velocity_for_lane_change_detection"
              ]
            },
            "lat_diff_distance": {
              "type": "object",
              "properties": {
                "dist_ratio_threshold_to_left_bound": {
                  "type": "number",
                  "default": -0.5
                },
                "dist_ratio_threshold_to_right_bound": {
                  "type": "number",
                  "default": 0.5
                },
                "diff_dist_threshold_to_left_bound": {
                  "type": "number",
                  "default": 0.29
                },
                "diff_dist_threshold_to_right_bound": {
                  "type": "number",
                  "default": -0.29
                }
              },
              "required": [
                "dist_ratio_threshold_to_left_bound",
                "dist_ratio_threshold_to_right_bound",
                "diff_dist_threshold_to_left_bound",
                "diff_dist_threshold_to_right_bound"
              ]
            },
            "num_continuous_state_transition": {
              "type": "number",
              "default": 3
            },
            "consider_only_routable_neighbours": {
              "type": "boolean",
              "default": false
            }
          },
          "required": [
            "method",
            "time_to_change_lane",
            "lat_diff_distance",
            "num_continuous_state_transition",
            "consider_only_routable_neighbours"
          ]
        },
        "reference_path_resolution": {
          "type": "number",
          "default": 0.5,
          "description": "Standard deviation for lateral position of objects "
        },
        "publish_processing_time": {
          "type": "boolean",
          "default": false
        },
        "publish_processing_time_detail": {
          "type": "boolean",
          "default": false
        },
        "publish_debug_markers": {
          "type": "boolean",
          "default": false
        },
        "processing_time_tolerance": {
          "type": "number",
          "default": 0.5
        },
        "processing_time_consecutive_excess_tolerance": {
          "type": "number",
          "default": 1.0
        }
      },
      "required": [
        "prediction_time_horizon",
        "lateral_control_time_horizon",
        "prediction_sampling_delta_time",
        "min_velocity_for_map_based_prediction",
        "min_crosswalk_user_velocity",
        "max_crosswalk_user_delta_yaw_threshold_for_lanelet",
        "max_crosswalk_user_on_road_distance",
        "dist_threshold_for_searching_lanelet",
        "delta_yaw_threshold_for_searching_lanelet",
        "sigma_lateral_offset",
        "sigma_yaw_angle_deg",
        "object_buffer_time_length",
        "history_time_length",
        "check_lateral_acceleration_constraints",
        "max_lateral_accel",
        "min_acceleration_before_curve",
        "use_vehicle_acceleration",
        "speed_limit_multiplier",
        "acceleration_exponential_half_life",
        "crosswalk_with_signal",
        "prediction_time_horizon_rate_for_validate_shoulder_lane_length",
        "use_crosswalk_user_history",
        "crossing_intention_duration",
        "no_crossing_intention_duration",
        "lane_change_detection",
        "reference_path_resolution",
        "publish_processing_time",
        "publish_processing_time_detail",
        "publish_debug_markers",
        "processing_time_tolerance",
        "processing_time_consecutive_excess_tolerance"
      ]
    }
  },
  "properties": {
    "/**": {
      "type": "object",
      "properties": {
        "ros__parameters": {
          "$ref": "#/definitions/map_based_prediction"
        }
      },
      "required": ["ros__parameters"]
    }
  },
  "required": ["/**"]
}
